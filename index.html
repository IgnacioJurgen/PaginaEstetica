<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EstéticaFlow - Control de Stock</title>
    
    <!-- 1. Cargamos React y ReactDOM desde Internet -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- 2. Cargamos Babel para traducir el código React en el navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 3. Cargamos Tailwind CSS para el diseño -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Estilos adicionales para iconos -->
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    </style>
</head>
<body class="bg-slate-50">

    <!-- Aquí es donde React "dibujará" la aplicación -->
    <div id="root"></div>

    <!-- Nuestro Código React -->
    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONOS (SVG Inline para no depender de librerías externas) ---
        const Icon = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );
        const Plus = ({size=24}) => <Icon className={`w-${size/4} h-${size/4}`}><path d="M5 12h14"/><path d="M12 5v14"/></Icon>;
        const Minus = ({size=24}) => <Icon className={`w-${size/4} h-${size/4}`}><path d="M5 12h14"/></Icon>;
        const AlertTriangle = ({size=24}) => <Icon className={`w-${size/4} h-${size/4}`}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></Icon>;
        const Calendar = ({size=24}) => <Icon className={`w-${size/4} h-${size/4}`}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></Icon>;
        const Search = ({size=24}) => <Icon className={`w-${size/4} h-${size/4}`}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></Icon>;
        const Package = ({size=24}) => <Icon className={`w-${size/4} h-${size/4}`}><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></Icon>;
        const TrendingDown = ({size=24}) => <Icon className={`w-${size/4} h-${size/4}`}><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></Icon>;
        const TrendingUp = ({size=24}) => <Icon className={`w-${size/4} h-${size/4}`}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></Icon>;
        const Filter = ({size=24}) => <Icon className={`w-${size/4} h-${size/4}`}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></Icon>;
        const Droplet = ({size=24}) => <Icon className={`w-${size/4} h-${size/4}`}><path d="M12 22a7 7 0 0 0 7-7c0-2-2-3-2-3 0-3-5-8-5-8s-5 5-5 8c0 0-2 1-2 3a7 7 0 0 0 7 7z"/></Icon>;

        // --- DATOS INICIALES ---
        const INITIAL_DATA = [
            { id: 1, name: "Ácido Hialurónico 2ml", category: "Inyectables", stock: 5, minStock: 3, unit: "viales", expiry: "2025-06-15", lastUpdate: "2023-10-20" },
            { id: 2, name: "Toxina Botulínica Tipo A", category: "Inyectables", stock: 12, minStock: 5, unit: "unidades", expiry: "2024-01-10", lastUpdate: "2023-10-18" },
            { id: 3, name: "Crema Hidratante Facial Pro", category: "Cabina", stock: 2, minStock: 4, unit: "botes", expiry: "2024-12-01", lastUpdate: "2023-09-05" },
            { id: 4, name: "Gasas Estériles (Paquete)", category: "Descartables", stock: 45, minStock: 20, unit: "paquetes", expiry: "2026-01-01", lastUpdate: "2023-10-22" },
            { id: 5, name: "Mascarilla de Alginatos", category: "Cabina", stock: 8, minStock: 10, unit: "sobres", expiry: "2023-11-30", lastUpdate: "2023-10-15" },
        ];

        // --- COMPONENTE PRINCIPAL ---
        const App = () => {
            const [products, setProducts] = useState(INITIAL_DATA);
            const [view, setView] = useState('inventory'); // 'inventory', 'add'
            const [searchTerm, setSearchTerm] = useState('');
            const [sortBy, setSortBy] = useState('expiry'); // 'expiry', 'stock', 'name'
            const [sortOrder, setSortOrder] = useState('asc');

            const [newProduct, setNewProduct] = useState({
                name: '',
                category: 'Cabina',
                stock: 0,
                minStock: 5,
                unit: 'unidades',
                expiry: ''
            });

            // Ordenamiento
            const sortedProducts = [...products].sort((a, b) => {
                let comparison = 0;
                if (sortBy === 'expiry') {
                    comparison = new Date(a.expiry) - new Date(b.expiry);
                } else if (sortBy === 'stock') {
                    comparison = a.stock - b.stock;
                } else {
                    comparison = a.name.localeCompare(b.name);
                }
                return sortOrder === 'asc' ? comparison : -comparison;
            });

            // Filtro
            const filteredProducts = sortedProducts.filter(p => 
                p.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                p.category.toLowerCase().includes(searchTerm.toLowerCase())
            );

            // Cálculos de estado
            const getExpiryStatus = (dateString) => {
                const today = new Date();
                const expiry = new Date(dateString);
                const diffTime = expiry - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays < 0) return { color: 'bg-red-100 text-red-800 border-red-200', text: 'Vencido', icon: AlertTriangle };
                if (diffDays < 30) return { color: 'bg-orange-100 text-orange-800 border-orange-200', text: `${diffDays} días`, icon: AlertTriangle };
                return { color: 'bg-emerald-100 text-emerald-800 border-emerald-200', text: 'Vigente', icon: Calendar };
            };

            const getStockStatus = (current, min) => {
                if (current === 0) return { color: 'text-red-600 bg-red-50', label: 'Sin Stock' };
                if (current <= min) return { color: 'text-orange-600 bg-orange-50', label: 'Bajo' };
                return { color: 'text-emerald-600 bg-emerald-50', label: 'Ok' };
            };

            // Handlers
            const handleUpdateStock = (id, amount) => {
                setProducts(products.map(p => {
                    if (p.id === id) {
                        const newStock = Math.max(0, p.stock + amount);
                        return { ...p, stock: newStock, lastUpdate: new Date().toISOString().split('T')[0] };
                    }
                    return p;
                }));
            };

            const handleAddProduct = (e) => {
                e.preventDefault();
                const product = {
                    ...newProduct,
                    id: Date.now(),
                    lastUpdate: new Date().toISOString().split('T')[0]
                };
                setProducts([...products, product]);
                setNewProduct({ name: '', category: 'Cabina', stock: 0, minStock: 5, unit: 'unidades', expiry: '' });
                setView('inventory');
            };

            // Dashboard Card Component
            const Card = ({ title, value, icon: IconComponent, colorClass, subtext }) => (
                <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 flex items-start justify-between">
                    <div>
                        <p className="text-slate-500 text-sm font-medium mb-1">{title}</p>
                        <h3 className="text-2xl font-bold text-slate-800">{value}</h3>
                        {subtext && <p className="text-xs text-slate-400 mt-2">{subtext}</p>}
                    </div>
                    <div className={`p-3 rounded-lg ${colorClass}`}>
                        <IconComponent size={24} />
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-800 pb-12">
                    {/* Navbar */}
                    <nav className="bg-white border-b border-slate-200 px-6 py-4 sticky top-0 z-10">
                        <div className="max-w-7xl mx-auto flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <div className="bg-rose-500 p-2 rounded-lg text-white">
                                    <Droplet size={24} />
                                </div>
                                <h1 className="text-xl font-bold text-slate-800 hidden md:block">EstéticaFlow <span className="text-rose-500">Control</span></h1>
                                <h1 className="text-xl font-bold text-slate-800 md:hidden">EF <span className="text-rose-500">App</span></h1>
                            </div>
                            <div className="flex gap-4">
                                <button 
                                    onClick={() => setView('inventory')}
                                    className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${view === 'inventory' ? 'bg-slate-100 text-slate-900' : 'text-slate-500 hover:text-slate-900'}`}
                                >
                                    Inventario
                                </button>
                                <button 
                                    onClick={() => setView('add')}
                                    className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${view === 'add' ? 'bg-rose-500 text-white shadow-md' : 'bg-slate-900 text-white hover:bg-slate-800'}`}
                                >
                                    <Plus size={16} /> <span className="hidden sm:inline">Nuevo Artículo</span>
                                </button>
                            </div>
                        </div>
                    </nav>

                    <main className="max-w-7xl mx-auto p-6">
                        
                        {/* Dashboard Stats */}
                        {view === 'inventory' && (
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <Card 
                                    title="Total Productos" 
                                    value={products.length} 
                                    icon={Package} 
                                    colorClass="bg-blue-50 text-blue-600" 
                                />
                                <Card 
                                    title="Stock Crítico" 
                                    value={products.filter(p => p.stock <= p.minStock).length} 
                                    subtext="Artículos por debajo del mínimo"
                                    icon={TrendingDown} 
                                    colorClass="bg-orange-50 text-orange-600" 
                                />
                                <Card 
                                    title="Alertas Vencimiento" 
                                    value={products.filter(p => getExpiryStatus(p.expiry).color.includes('red') || getExpiryStatus(p.expiry).color.includes('orange')).length} 
                                    subtext="Vencidos o vencen < 30 días"
                                    icon={AlertTriangle} 
                                    colorClass="bg-rose-50 text-rose-600" 
                                />
                            </div>
                        )}

                        {view === 'inventory' ? (
                            <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                {/* Toolbar */}
                                <div className="p-5 border-b border-slate-100 flex flex-col md:flex-row gap-4 justify-between bg-slate-50/50">
                                    <div className="relative flex-1 max-w-md">
                                        <div className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">
                                            <Search size={18} />
                                        </div>
                                        <input 
                                            type="text"
                                            placeholder="Buscar por nombre o categoría..."
                                            className="w-full pl-10 pr-4 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-rose-500/20 focus:border-rose-500 transition-all"
                                            value={searchTerm}
                                            onChange={(e) => setSearchTerm(e.target.value)}
                                        />
                                    </div>
                                    
                                    <div className="flex gap-3 items-center">
                                        <span className="text-sm text-slate-500 flex items-center gap-2 hidden sm:flex">
                                            <Filter size={16} /> Ordenar:
                                        </span>
                                        <select 
                                            className="px-3 py-2 rounded-lg border border-slate-200 bg-white text-sm focus:outline-none focus:border-rose-500"
                                            value={sortBy}
                                            onChange={(e) => setSortBy(e.target.value)}
                                        >
                                            <option value="expiry">Vencimiento</option>
                                            <option value="stock">Stock</option>
                                            <option value="name">Nombre</option>
                                        </select>
                                        <button 
                                            onClick={() => setSortOrder(prev => prev === 'asc' ? 'desc' : 'asc')}
                                            className="p-2 border border-slate-200 rounded-lg hover:bg-slate-50"
                                        >
                                            {sortOrder === 'asc' ? <TrendingUp size={18} className="text-slate-600"/> : <TrendingDown size={18} className="text-slate-600"/>}
                                        </button>
                                    </div>
                                </div>

                                {/* Table */}
                                <div className="overflow-x-auto">
                                    <table className="w-full text-left border-collapse">
                                        <thead>
                                            <tr className="bg-slate-50 text-slate-500 text-xs uppercase tracking-wider border-b border-slate-200">
                                                <th className="p-4 font-semibold">Producto</th>
                                                <th className="p-4 font-semibold hidden sm:table-cell">Categoría</th>
                                                <th className="p-4 font-semibold text-center">Stock</th>
                                                <th className="p-4 font-semibold text-center">Acción</th>
                                                <th className="p-4 font-semibold hidden md:table-cell">Vencimiento</th>
                                                <th className="p-4 font-semibold text-right">Estado</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {filteredProducts.map((product) => {
                                                const stockStatus = getStockStatus(product.stock, product.minStock);
                                                const expiryData = getExpiryStatus(product.expiry);
                                                const ExpiryIcon = expiryData.icon;

                                                return (
                                                    <tr key={product.id} className="hover:bg-slate-50/50 transition-colors group">
                                                        <td className="p-4">
                                                            <div className="font-medium text-slate-900">{product.name}</div>
                                                            <div className="text-xs text-slate-400">{product.unit}</div>
                                                            <div className="md:hidden text-xs text-slate-500 mt-1">{product.expiry}</div>
                                                        </td>
                                                        <td className="p-4 hidden sm:table-cell">
                                                            <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-100 text-slate-800">
                                                                {product.category}
                                                            </span>
                                                        </td>
                                                        <td className="p-4 text-center">
                                                            <div className={`font-bold text-lg ${stockStatus.color.split(' ')[0]}`}>
                                                                {product.stock}
                                                            </div>
                                                            <div className={`text-xs px-2 py-0.5 rounded-full inline-block mt-1 ${stockStatus.color}`}>
                                                                Min: {product.minStock}
                                                            </div>
                                                        </td>
                                                        <td className="p-4">
                                                            <div className="flex items-center justify-center gap-2">
                                                                <button 
                                                                    onClick={() => handleUpdateStock(product.id, -1)}
                                                                    className="w-8 h-8 flex items-center justify-center rounded-full border border-slate-200 text-slate-600 hover:bg-rose-50 hover:text-rose-600 hover:border-rose-200 transition-all"
                                                                    title="Registrar Consumo"
                                                                >
                                                                    <Minus size={14} />
                                                                </button>
                                                                <button 
                                                                    onClick={() => handleUpdateStock(product.id, 1)}
                                                                    className="w-8 h-8 flex items-center justify-center rounded-full border border-slate-200 text-slate-600 hover:bg-emerald-50 hover:text-emerald-600 hover:border-emerald-200 transition-all"
                                                                    title="Reponer Stock"
                                                                >
                                                                    <Plus size={14} />
                                                                </button>
                                                            </div>
                                                        </td>
                                                        <td className="p-4 text-sm text-slate-600 font-mono hidden md:table-cell">
                                                            {product.expiry}
                                                        </td>
                                                        <td className="p-4 text-right">
                                                            <div className={`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium border ${expiryData.color}`}>
                                                                <ExpiryIcon size={12} />
                                                                <span className="hidden sm:inline">{expiryData.text}</span>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </div>
                                {filteredProducts.length === 0 && (
                                    <div className="p-12 text-center text-slate-400">
                                        <div className="flex justify-center mb-4 opacity-20"><Package size={48} /></div>
                                        <p>No se encontraron productos con ese criterio.</p>
                                    </div>
                                )}
                            </div>
                        ) : (
                            /* Add Product View */
                            <div className="max-w-2xl mx-auto bg-white rounded-xl shadow-sm border border-slate-200 p-8">
                                <div className="mb-6 text-center">
                                    <div className="w-12 h-12 bg-rose-100 text-rose-600 rounded-full flex items-center justify-center mx-auto mb-3">
                                        <Plus size={24} />
                                    </div>
                                    <h2 className="text-2xl font-bold text-slate-800">Ingresar Nuevo Artículo</h2>
                                    <p className="text-slate-500">Complete los datos para el control de stock</p>
                                </div>

                                <form onSubmit={handleAddProduct} className="space-y-6">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div className="col-span-2">
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Nombre del Producto</label>
                                            <input 
                                                required
                                                type="text" 
                                                className="w-full px-4 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-rose-500 focus:border-transparent outline-none"
                                                placeholder="Ej: Crema Reafirmante Corporal"
                                                value={newProduct.name}
                                                onChange={e => setNewProduct({...newProduct, name: e.target.value})}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Categoría</label>
                                            <select 
                                                className="w-full px-4 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-rose-500 focus:border-transparent outline-none bg-white"
                                                value={newProduct.category}
                                                onChange={e => setNewProduct({...newProduct, category: e.target.value})}
                                            >
                                                <option>Cabina</option>
                                                <option>Inyectables</option>
                                                <option>Descartables</option>
                                                <option>Venta Público</option>
                                                <option>Limpieza</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Unidad de Medida</label>
                                            <input 
                                                type="text" 
                                                className="w-full px-4 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-rose-500 focus:border-transparent outline-none"
                                                placeholder="ml, cajas, unidades..."
                                                value={newProduct.unit}
                                                onChange={e => setNewProduct({...newProduct, unit: e.target.value})}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Stock Inicial</label>
                                            <input 
                                                required
                                                type="number" 
                                                min="0"
                                                className="w-full px-4 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-rose-500 focus:border-transparent outline-none"
                                                value={newProduct.stock}
                                                onChange={e => setNewProduct({...newProduct, stock: parseInt(e.target.value)})}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Stock Mínimo (Alerta)</label>
                                            <input 
                                                required
                                                type="number" 
                                                min="1"
                                                className="w-full px-4 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-rose-500 focus:border-transparent outline-none"
                                                value={newProduct.minStock}
                                                onChange={e => setNewProduct({...newProduct, minStock: parseInt(e.target.value)})}
                                            />
                                        </div>

                                        <div className="col-span-2">
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Fecha de Vencimiento</label>
                                            <input 
                                                required
                                                type="date" 
                                                className="w-full px-4 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-rose-500 focus:border-transparent outline-none"
                                                value={newProduct.expiry}
                                                onChange={e => setNewProduct({...newProduct, expiry: e.target.value})}
                                            />
                                            <p className="text-xs text-slate-500 mt-1 flex items-center gap-1">
                                                <AlertTriangle size={12} /> Importante para el cálculo de alertas automáticas
                                            </p>
                                        </div>
                                    </div>

                                    <div className="flex gap-4 pt-4 border-t border-slate-100">
                                        <button 
                                            type="button" 
                                            onClick={() => setView('inventory')}
                                            className="flex-1 px-4 py-3 rounded-lg border border-slate-300 text-slate-700 font-medium hover:bg-slate-50 transition-colors"
                                        >
                                            Cancelar
                                        </button>
                                        <button 
                                            type="submit" 
                                            className="flex-1 px-4 py-3 rounded-lg bg-rose-600 text-white font-medium hover:bg-rose-700 shadow-lg shadow-rose-200 transition-all"
                                        >
                                            Guardar Producto
                                        </button>
                                    </div>
                                </form>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        // Renderizamos la aplicación
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
